# Privilege Escalation, Persistence & Covering Your Tracks
## LINUX
## priv escalation


### demo
```
sudo -l
id
w 
uname -a 
ps -elf
ls -la /etc/sudoers
ls -la /etc/sudoers.d
```
### SUID/SGID

The find command is likely the best tool for finding binaries that are SGID or SUID:
`find / -type f -perm /4000 -ls 2>/dev/null` # Find SUID only files
`find / -type f -perm /2000 -ls 2>/dev/null` # Find SGID only files
`find / -type f -perm /6000 -ls 2>/dev/null` # Find SUID and/or SGID files

`which passwd`
if the bit is set then thats files privledges will be granted to your user no matter your priv
`ls -la /usr/bin/pkexec` popular vulnerablity in past 

### CRON
`/var/spool/cron/crontabs/bob`
`/etc/crontab`

### world-writable files and folders


### dot "." in path
= hidden
`echo $PATH`
it adds working directory to path
`/bin/ls -la`
`which netstat`
`netstat ` can run this command instead of /bin/netstat everytime
`cd /tmp`
`which nc`
`cp /bin/nc /tmp/netstat`
`PATH=.:$PATH`
`echo $PATH`
`netstat` is going to check /tmp first since it your current working directory
`netstat -nvlp 8888` is actually nc obfuscated as netstat

### vulnerable software services and unpatched kernel vulnerabilities
dirtycow
pkexec
other tools besides sudo


## persistence


### adding or hijacking a user account

### boot process persistence
init.d

### cron job

### kernel module backdoors

## Covering your tracks

### artifcats
things left behind 
like files, logs, errors 
buffer overflow example

journald --verify
journalctl --verify

### system usage
using too much can slow down your machine

## NIX-ism
`unset HISTFILE`
be aware of init system: [SYSTEMV], upstart, [SYSTEMD]
determines what commands to use and logging structure

figure out init system:
```
ls -latr /proc/1/exe
stat /sbin/init
man init
init --version
ps 1
```
auditing SYSTEMV
`ausearch`: pulls from audit.log
```
ausearch -p 22
ausearch -m USER_LOGIN -sv no
ausearch -ua edwards -ts yesterday -te now -i
```
... wont worry bout this for test


 auditiing SYSTEMD
 utilized: `journalctl`
 ```
journalctl _TRANSPORT=audit
journalctl _TRANSPORT=audit | grep 603
```

Logs for Covering Tracks
| Logs typically housed in /var/log & useful logs: |
|--------|---------------------------------------|
| auth.log/secure | Logins/authentications |
| lastlog | Each users' last successful login time |
| btmp | Bad login attempts |
| sulog | Usage of SU command |
| utmp | Currently logged in users (W command) |
| wtmp | Permanent record on user on/off |

